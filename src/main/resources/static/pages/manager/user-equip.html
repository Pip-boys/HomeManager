<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>用户设备</title>
<meta name="description" content="这是一个 index 页面">
<meta name="keywords" content="index">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="renderer" content="webkit">
<meta http-equiv="Cache-Control" content="no-siteapp" />
<link rel="icon" type="image/png"
	href="../../js/amazeUI/assets/i/favicon.png">
<link rel="apple-touch-icon-precomposed"
	href="../../js/amazeUI/assets/i/app-icon72x72@2x.png">
<meta name="apple-mobile-web-app-title" content="Amaze UI" />
<!-- <script src="../../js/amazeUI/assets/js/echarts.min.js"></script> -->
<link rel="stylesheet"
	href="../../js/amazeUI/assets/css/amazeui.min.css" />
<link rel="stylesheet"
	href="../../js/amazeUI/assets/css/amazeui.datatables.min.css" />
<link rel="stylesheet" href="../../js/amazeUI/assets/css/app.css">
<link rel="stylesheet" href="../../css/mricode.pagination.css">
<script src="../../js/amazeUI/assets/js/jquery.min.js"></script>
<script type="text/javascript" src="../../js/common/mricode.pagination.js"></script>
<script type="text/javascript" src="../../js/common/init-common-jq.js"></script>

</head>


<body data-type="widgets">
    <script src="../../js/amazeUI/assets/js/theme.js"></script>
    <div class="am-g tpl-g">
        <!-- 头部 -->
        <header>
            <!-- logo -->
            <div class="am-fl tpl-header-logo">
                <a href="javascript:;"><img src="../../js/amazeUI/assets/img/logo.png" alt=""></a>
            </div>
            <!-- 右侧内容 -->
            <div class="tpl-header-fluid">
                <!-- 侧边切换 -->
                <div class="am-fl tpl-header-switch-button am-icon-list">
                    <span>

                </span>
                </div>
                <!-- 搜索 -->
                <div class="am-fl tpl-header-search">
                    <form class="tpl-header-search-form" action="javascript:;">
                        <button class="tpl-header-search-btn am-icon-search"></button>
                        <input class="tpl-header-search-box" type="text" placeholder="搜索内容...">
                    </form>
                </div>
                <!-- 其它功能-->
                <div class="am-fr tpl-header-navbar">
                    <ul>
                        <!-- 欢迎语 -->
                        <li class="am-text-sm tpl-header-navbar-welcome">
                            <a href="javascript:;">欢迎你, <span>Amaze UI</span> </a>
                        </li>

                        <!-- 新邮件 -->
                        <li class="am-dropdown tpl-dropdown" data-am-dropdown>
                            <a href="javascript:;" class="am-dropdown-toggle tpl-dropdown-toggle" data-am-dropdown-toggle>
                                <i class="am-icon-envelope"></i>
                                <span class="am-badge am-badge-success am-round item-feed-badge">4</span>
                            </a>
                            <!-- 弹出列表 -->
                            <ul class="am-dropdown-content tpl-dropdown-content">
                                <li class="tpl-dropdown-menu-messages">
                                    <a href="javascript:;" class="tpl-dropdown-menu-messages-item am-cf">
                                        <div class="menu-messages-ico">
                                            <img src="../../js/amazeUI/assets/img/user04.png" alt="">
                                        </div>
                                        <div class="menu-messages-time">
                                            3小时前
                                        </div>
                                        <div class="menu-messages-content">
                                            <div class="menu-messages-content-title">
                                                <i class="am-icon-circle-o am-text-success"></i>
                                                <span>夕风色</span>
                                            </div>
                                            <div class="am-text-truncate"> Amaze UI 的诞生，依托于 GitHub 及其他技术社区上一些优秀的资源；Amaze UI 的成长，则离不开用户的支持。 </div>
                                            <div class="menu-messages-content-time">2016-09-21 下午 16:40</div>
                                        </div>
                                    </a>
                                </li>

                                <li class="tpl-dropdown-menu-messages">
                                    <a href="javascript:;" class="tpl-dropdown-menu-messages-item am-cf">
                                        <div class="menu-messages-ico">
                                            <img src="../../js/amazeUI/assets/img/user02.png" alt="">
                                        </div>
                                        <div class="menu-messages-time">
                                            5天前
                                        </div>
                                        <div class="menu-messages-content">
                                            <div class="menu-messages-content-title">
                                                <i class="am-icon-circle-o am-text-warning"></i>
                                                <span>禁言小张</span>
                                            </div>
                                            <div class="am-text-truncate"> 为了能最准确的传达所描述的问题， 建议你在反馈时附上演示，方便我们理解。 </div>
                                            <div class="menu-messages-content-time">2016-09-16 上午 09:23</div>
                                        </div>
                                    </a>
                                </li>
                                <li class="tpl-dropdown-menu-messages">
                                    <a href="javascript:;" class="tpl-dropdown-menu-messages-item am-cf">
                                        <i class="am-icon-circle-o"></i> 进入列表…
                                    </a>
                                </li>
                            </ul>
                        </li>

                        <!-- 新提示 -->
                        <li class="am-dropdown" data-am-dropdown>
                            <a href="javascript:;" class="am-dropdown-toggle" data-am-dropdown-toggle>
                                <i class="am-icon-bell"></i>
                                <span class="am-badge am-badge-warning am-round item-feed-badge">5</span>
                            </a>

                            <!-- 弹出列表 -->
                            <ul class="am-dropdown-content tpl-dropdown-content">
                                <li class="tpl-dropdown-menu-notifications">
                                    <a href="javascript:;" class="tpl-dropdown-menu-notifications-item am-cf">
                                        <div class="tpl-dropdown-menu-notifications-title">
                                            <i class="am-icon-line-chart"></i>
                                            <span> 有6笔新的销售订单</span>
                                        </div>
                                        <div class="tpl-dropdown-menu-notifications-time">
                                            12分钟前
                                        </div>
                                    </a>
                                </li>
                                <li class="tpl-dropdown-menu-notifications">
                                    <a href="javascript:;" class="tpl-dropdown-menu-notifications-item am-cf">
                                        <div class="tpl-dropdown-menu-notifications-title">
                                            <i class="am-icon-star"></i>
                                            <span> 有3个来自人事部的消息</span>
                                        </div>
                                        <div class="tpl-dropdown-menu-notifications-time">
                                            30分钟前
                                        </div>
                                    </a>
                                </li>
                                <li class="tpl-dropdown-menu-notifications">
                                    <a href="javascript:;" class="tpl-dropdown-menu-notifications-item am-cf">
                                        <div class="tpl-dropdown-menu-notifications-title">
                                            <i class="am-icon-folder-o"></i>
                                            <span> 上午开会记录存档</span>
                                        </div>
                                        <div class="tpl-dropdown-menu-notifications-time">
                                            1天前
                                        </div>
                                    </a>
                                </li>


                                <li class="tpl-dropdown-menu-notifications">
                                    <a href="javascript:;" class="tpl-dropdown-menu-notifications-item am-cf">
                                        <i class="am-icon-bell"></i> 进入列表…
                                    </a>
                                </li>
                            </ul>
                        </li>

                        <!-- 退出 -->
						<li class="am-text-sm"><a href="/logout"> <span
								class="am-icon-sign-out"></span> 退出
						</a></li>
                    </ul>
                </div>
            </div>

        </header>
        <!-- 风格切换 -->
        <div class="tpl-skiner">
            <div class="tpl-skiner-toggle am-icon-cog">
            </div>
            <div class="tpl-skiner-content">
                <div class="tpl-skiner-content-title">
                    选择主题
                </div>
                <div class="tpl-skiner-content-bar">
                    <span class="skiner-color skiner-white" data-color="theme-white"></span>
                    <span class="skiner-color skiner-black" data-color="theme-black"></span>
                </div>
            </div>
        </div>
        
		<!-- 侧边导航栏 -->
		<div class="left-sidebar" id="leftMenu">
            
        </div>

        <!-- 内容区域 -->
        <div class="tpl-content-wrapper">

            <div class="container-fluid am-cf">
                <div class="row">
                    <div class="am-u-sm-12 am-u-md-12 am-u-lg-9">
                        <div class="page-header-heading"><span class="am-icon-home page-header-heading-icon"></span> 表格 <small>Amaze UI</small></div>
                        <p class="page-header-description">Amaze UI 有许多不同的表格可用。</p>
                    </div>
                    <div class="am-u-lg-3 tpl-index-settings-button">
                        <button type="button" class="page-header-button"><span class="am-icon-paint-brush"></span> 设置</button>
                    </div>
                </div>

            </div>
            <div id="userEquipVue">
               	<div class="row am-cf">
                   <div class="am-u-md-6" v-for="(item,index) in userEquipList">
                       <div class="widget am-cf">
                           <div class="widget-head am-cf">
                               <div style="font-size: 22px;color: #b76c6c;" class="widget-title am-fl">
                               	{{item.vcName}}
                               	<span style="font-size: 12px">{{item.vcModel}}</span>
                               	</div>
                           </div>
                          	<!--  <textarea rows="1" cols="1" style="border:none;width: 100%;">{{item.vcIntroduce}}</textarea> -->
                           <img style="margin-left: 10%" @click="getDetail(item)" class="am-round am-img-responsive" alt="140*140"  :src="item.vcPic" />
                           <hr>
                           	   <span>显示数据</span>
                           	   <div class="tpl-switch">
									<input type="checkbox" class="ios-switch bigswitch tpl-switch-btn" v-model="item.nStatus" @change="clickStatus(item)">
									<div class="tpl-switch-btn-view">
										<div></div>
									</div>
							   </div>
							   <div v-for="(it,index) in item.slowEquipDataList">
							   	<span>{{it.vcDataName}}: </span>
							   	<span v-for="(i,index) in it.typeList">
							   		<input type="radio" :name="it.nId" :value="i" v-model="it.vcData" @click="clickEquipData(i,it,item)">{{i}}
							   	</span>
							   	
							   </div>
                           <hr>
                           <div v-if="item.nStatus" class="widget-body-md widget-body tpl-amendment-echarts am-fr" :id="it.id" v-for="(it,index) in item.fastEcharList">
                           
                           </div>
                       </div>
                   </div>
             	</div>
            </div>
                
        	<div class="am-u-lg-12 am-cf">
				<div id="pagination" class="m-pagination" style="margin-left: 40%; float: none; margin-top: 10%;">
				</div>
			</div>
			
        </div>
    </div>
    </div>
    <script src="../../js/amazeUI/assets/js/amazeui.min.js"></script>
	<script src="../../js/amazeUI/assets/js/amazeui.datatables.min.js"></script>
	<script src="../../js/amazeUI/assets/js/dataTables.responsive.min.js"></script>
	<script src="../../js/amazeUI/assets/js/app.js"></script>

	<script src="../../js/vue.js"></script>
	<script type="text/javascript"
		src="../../js/amazeUI/assets/js/axios.min.js"></script>
	<script type="text/javascript" src="../../js/common/init-menu-vue.js"></script>
	<script type="text/javascript" src="../../js/common/left-menu.js"></script>
	<script src="http://echarts.baidu.com/build/dist/echarts.js"></script>
	<script type="text/javascript" src="../../js/common/init-echar-data.js"></script>
	<script type="text/javascript">
	var userEquipVue = new Vue({
		el : '#userEquipVue',
		data : {
			userEquipList:[]
		},
		mounted:function (){
            setInterval(this.refreshFastData, 5000);
            //setInterval(this.refreshSlowData, 20000);
		},
		methods : {
			onclick : function() {
				
			},
			refreshFastData : function() {
				var list=new Array();
				for(var i in userEquipVue.userEquipList){
					if(userEquipVue.userEquipList[i].nStatus==true){
						list.push(userEquipVue.userEquipList[i].nId);
					}
				}
				this.$http.get("equip/userSelfFastEuqipDataList/"+list.join(",")).then(response => {
					var data=response.data;
					if(data.status==200){
						userEquipVue.initFastDataList(data.data,userEquipVue.userEquipList);
						userEquipVue.eCharInit();
					}
				}).catch((err) => {
	                alert("网络异常");
				});
			},
			refreshSlowData : function() {
				
			},
			clickStatus : function(item) {
				$.AMUI.progress.start(); 
				//alert(item.nStatus);
				var obj=new Object();
				obj.nStatus=item.nStatus;
				obj.nId=item.nId;
				var params=JSON.stringify(obj);
				this.$http.post("equip/userEquip",params).then(response => {
					$.AMUI.progress.done();
					var data=response.data;
					if(data.status!=200){
						item.nStatus=!item.nStatus;
					}
				}).catch((err) => {
	                alert("网络异常");
				});
			},
			eCharInit :function(){
				require.config({
				    paths: {echarts: 'http://echarts.baidu.com/build/dist'}
				});
				require(
				    [ 'echarts','echarts/chart/bar','echarts/chart/line'],
					function (ec) {
					    // 基于准备好的dom，初始化echarts图表
					    for(var i in userEquipVue.userEquipList){
					    	var fastEcharList=userEquipVue.userEquipList[i].fastEcharList;
					    	for(var y in fastEcharList){
					    		var echar=fastEcharList[y];
					    		var div=document.getElementById(echar.id);
					    		if(div!=undefined&&div!=null){
					    			var myChart = ec.init(div);
					    			// 为echarts对象加载数据 
									myChart.setOption(echar); 
					    		}
					    	}
					    }
				    }
				); 
			},
			getSplit : function(str){
				var result=str.split(",")
				return result;
			},
			clickEquipData : function(vcData,it,item){
				$.AMUI.progress.start(); 
				var obj=new Object();
				obj.vcData=vcData;
				obj.vcDataName=it.vcDataName;
				obj.nPid=item.nId;
				obj.nType=item.nType;
				var params=JSON.stringify(obj);
				this.$http.put("equip/userSlowEquipData",params).then(response => {
					$.AMUI.progress.done();
					var data=response.data;
					if(data.status!=200){
						
					}
				}).catch((err) => {
	                alert("网络异常，请稍后重试");
				});
			},
			initFastDataList : function(fastEquipDataList,userEquipList){
				//console.log(fastEquipDataList);
				for(var i in fastEquipDataList){
					var nPid=fastEquipDataList[i].nPid;
					var map=objectListMapTrun(fastEquipDataList[i].equipDataList,'vcDataName',2);
					var y=1;
					for(var j in userEquipList){
						var fastEcharList=new Array();
						if(userEquipList[j].nId==nPid){
							for(var [key, value] of map){
								var option=clone(optionLineBar);
								option.id="option-"+nPid+"-"+y++;
								option.title.subtext='实时数据';
								var result=key.split(",");
								option.legend.data=[result[0]];
								option.series[0].name=result[0];
								option.yAxis[0].axisLabel.formatter='{value} '+result[1];
								option.xAxis[0].name=result[0];
								var tempList=new Array();
								var tempList2=new Array();
								var valueList=map.get(key);
								for(var x in valueList){
									tempList.unshift(dateFmtHMS(valueList[x].dtCre));
									if(valueList[x].vcData.indexOf(".") >= 0){
										tempList2.unshift(parseFloat(valueList[x].vcData))  
									}else{
										tempList2.unshift(parseInt(valueList[x].vcData))  
									}
									if(tempList.length>=7){
										break;
									}
								}
								option.xAxis[0].data=tempList;
								option.series[0].data=tempList2;
								fastEcharList.push(option);
							}
							userEquipList[j].fastEcharList=fastEcharList;
							userEquipList[j].fastDataList=map;
							continue;
						}
					}
					
				}
				return userEquipList;
			},
			dateFormat : function (val){
				if(val==undefined||val=="")return "";
				var date = new Date(val);
			    Y = date.getFullYear() + '-';
			    M = (date.getMonth()+1 < 10 ? '0'+(date.getMonth()+1) : date.getMonth()+1) + '-';
			    D = date.getDate()>9 ? date.getDate()+' ' : '0'+date.getDate()+' ';
			    return Y+M+D;
			},
			dateToGMT: function(strDate){
	            strDate = strDate.replace(/-/g," ").replace(/T/g," ").replace(/:/g," ");
	            var dateStr=strDate.split(" ");  
	            var date=new Date(dateStr[0],dateStr[1]-1,dateStr[2]);
	            return date;
			}
		}
	});
	</script>
	
	<script type="text/javascript">
	var baseUrl=host+'/equip/userSelfAllEuqipDataList';
	$(function() {
		$("#pagination").css('float', 'none');
		$("#pagination").pagination({
			pageIndex: 0,
            pageSize: 5,
            pageSizeItems: [5, 10, 15],
			remote : {
				beforeSend: $.AMUI.progress.start(), 
				complete: $.AMUI.progress.done(),
				url : baseUrl,
				success : function(result) {
					var fastEquipDataList=result.otherDate.fastEquipDataList;
					var userEquipList=result.otherDate.userEquipList;
					var typeList=result.otherDate.typeList;
					var slowEquipDataList=result.otherDate.slowEquipDataList;	
					userEquipVue.initFastDataList(fastEquipDataList,userEquipList);
					
					//优化方案可以是，克隆对象，一旦付过值的列表就将这个对象从数组中移除
					for(var i in typeList){
						var nType=typeList[i].nType;
						var equipDataTypeList=typeList[i].equipDataTypeList;
						for(var j in userEquipList){
							if(userEquipList[j].nType==nType){
								var list=new Array();
								for(var x in equipDataTypeList){
									var vcUnit=equipDataTypeList[x].vcUnit;
									if(vcUnit.indexOf(",")>0){
										list.push(equipDataTypeList[x]);
									}
								}
								userEquipList[j].typeList=list;
							}
						}
					}
					
					for(var i in slowEquipDataList){
						var nPid=slowEquipDataList[i].nPid;
						var list=objectListMapTrun(slowEquipDataList[i].equipDataList,'vcDataName',1);
						for(var j in userEquipList){
							if(userEquipList[j].nId==nPid){
								var temp=new Array();
								for(var x in list){
									temp.push(list[x][0]);
								}
								userEquipList[j].slowEquipDataList=temp;
							}
						}
					}
					
					for(var i in userEquipList){
						var slowEquipDataList=userEquipList[i].slowEquipDataList;
						var typeList=userEquipList[i].typeList;
						for(var j in slowEquipDataList){
							for(var x in typeList){
								if(slowEquipDataList[j].vcDataName==typeList[x].vcDataName){
									userEquipList[i].slowEquipDataList[j].typeList=typeList[x].vcUnit.split(",");
									break;
								}
							}
						}
					}
					
					//userEquipVue.userEquipList=listSplitTow(userEquipList);
					userEquipVue.userEquipList=userEquipList;
					userEquipVue.eCharInit();
				}
			}
		});
		
		
	})
	
	
	</script>
</body>

</html>